{% extends 'base.html' %}

{% import 'bootstrap5/form.html' as wtf %}

{% block head %}
<!-- add a big banner to welcome user -->
<div class="p-5 text-white bg-image"
    style="background-image: url({{ url_for('static', filename='img/9e7c614a-a990-11f0-9f66-700894b19280.png') }}); background-size: cover;">
    <div class="text-white text-center py-5 px-4">
        <div>
            <h1 class="display-2">Welcome to Milton Tours</h1>
            <p class="display-4 text-dark">
                Maybe, You need a vacation!
                {% if session['user'] %}
                <br> {{ session['user']['firstname'] }}!
                {% endif %}
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block main %}
<!-- marketing information -->
<section class="shadow-sm mb-3">
    <div class="container">
        <div class="text-white text-center">
            <div>
                <p class="h1 text-dark mb-4">Why us?</p>
            </div>
        </div>
        <!-- CSS Grid -->
        <div class="row">
            <div class="col-md-6">
                <article>
                    <h2>Beautiful locations</h2>
                    <p>We have tours in some of the best locations all around Australia:</p>
                    <ul>
                        <li>Close to city center</li>
                        <li>Free shuttle service to Airport</li>
                        <li>Helpful staff</li>
                    </ul>
                </article>
            </div>
            <div class="col-md-6">
                <article>
                    <h2>Affordable selections</h2>
                    <p>We have <span> great prices and offers </span> all year round!</p>
                    <p>Click <a href="discounts.html">here</a> for more information.</p>
                </article>
            </div>
        </div>
    </div>
</section>

<!-- Horizontal Rule -->
<hr class="border border-primary border-3 mb-3">

<!-- display the cities to the user -->
<section class="shadow-sm p-5" id="cities">
    <div class="text-dark text-center">
        <div>
            <p class="h3 text-dark mb-4" id="cities_anchor">Pick a city to see what we have to offer!</p>
        </div>
    </div>
    <div class="row ps-2 pe-2">
        {% for image in images %}
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <img class="card-img-top"
                    src="{{ url_for('static', filename='img/' + image.imageID + image.extension) }}" alt="Card image">
                <div class="card-body">
                    <h4 class="card-title">{{ image.title }}</h4>
                    <p class="card-text">{{ image.description }}</p>
                </div>
                <div class="card-footer">
                    <button onclick="addCart('{{ image.imageID }}')" class="btn btn-primary">Add to cart</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    async function addCart(imageID) {
        const response = await fetch(`/cart/${imageID}`, { method: "POST" });
        if (response.status === 401) {
            const data = await response.json();
            window.location.href = data.redirect;  // chuyển trang tại client
            return;
        }
    }
</script>
{% endblock %}