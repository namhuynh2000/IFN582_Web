{% extends 'base.html' %}

{% import 'bootstrap5/form.html' as wtf %}

{% block main %}

<section class="mb-5 mt-5 col-auto">

    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-5">
                <h1>Manager</h1>
            </div>
        </div>
        <details class="mb-3 shadow-lg rounded">
            <summary class="text-bg-dark ps-2 rounded text-center">
                <span class="lead"><i class="bi bi-file-earmark-plus"></i> Add Image</span>
            </summary>
            <div class="row justify-content-center p-3">
                <div class="col-md-6">
                    <p>
                        Adds a new image to your gallery.
                        <br>
                    </p>
                    {{ wtf.render_form(addImageForm) }}
                </div>
            </div>
        </details>

        <h1>Dashboard</h1>
        <div class="container my-4">
            <div class="row">
                {% if vendor_images %}
                {% for img in vendor_images %}
                <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex align-items-stretch">
                    <div class="card shadow-sm w-100">
                        <img class="card-img-top"
                            src="{{ url_for('static', filename='img/' ~ img.imageID ~ img.extension) }}"
                            alt="{{ img.title }}" style="height: 200px; object-fit: cover;">

                        <div class="card-body">
                            <h4 class="card-title">{{ img.title }}</h4>
                            <p class="card-text">Last updated: {{ img.updateDate }}</p>
                            <p class="card-title"><i class="bi bi-tag-fill"></i><strong>Price:</strong> {{ img.currency
                                }} ${{ img.price }}</p>

                        </div>

                        <div class="card-footer">
                            <details class="mb-3 shadow-lg rounded">
                                <summary class="text-bg-dark ps-2 rounded">
                                    <span class="lead">Edit</span>
                                </summary>

                                <div class="p-3">
                                    <p><strong>Image's Details</strong></p>
                                    <form method="POST" action="{{ url_for('main.update_image', imageID=img.imageID) }}"
                                        id="vendorForm">
                                        {{ edit_forms[img.imageID].hidden_tag() }}
                                        {{ edit_forms[img.imageID].title.label(class="form-label font-weight-bold") }}
                                        {{ edit_forms[img.imageID].title(class="form-control") }}
                                        {{ edit_forms[img.imageID].description.label(class="form-label font-weight-bold
                                        mt-2") }}
                                        {{ edit_forms[img.imageID].description(class="form-control") }}
                                        {{ edit_forms[img.imageID].price.label(class="form-label font-weight-bold mt-2")
                                        }}
                                        {{ edit_forms[img.imageID].price(class="form-control") }}
                                        {{ edit_forms[img.imageID].currency.label(class="form-label font-weight-bold
                                        mt-2") }}
                                        {{ edit_forms[img.imageID].currency(class="form-select") }}
                                        {{ edit_forms[img.imageID].categories.label(class="form-label font-weight-bold
                                        mt-2") }}
                                        {{ edit_forms[img.imageID].categories() }}
                                        {{ edit_forms[img.imageID].imageStatus.label(class="form-label font-weight-bold
                                        mt-2") }}
                                        {{ edit_forms[img.imageID].imageStatus() }}

                                        <div class="row justify-content-center mt-3">
                                            <div class="col-auto">
                                                {{ edit_forms[img.imageID].submit(class="btn btn-primary") }}
                                            </div>

                                        </div>
                                    </form>
                                    <div class="row justify-content-center">
                                        <div class="col-auto">
                                            <form method="POST"
                                                action="{{ url_for('main.delete_image', imageID=img.imageID) }}"
                                                onsubmit="return confirm('Are you sure you want to delete this image?');">
                                                <button type="submit" class="btn btn-danger">Delete Image</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <p>No images uploaded yet.</p>
                {% endif %}
            </div>
        </div>
</section>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}